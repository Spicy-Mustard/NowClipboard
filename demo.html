<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NowClipboard Demo</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: #f5f9f5;
      min-height: 100vh;
      padding: 40px 20px;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
    }
    h1 {
      color: #2d5a3d;
      text-align: center;
      margin-bottom: 10px;
      font-size: 2.5em;
      font-weight: 600;
    }
    .subtitle {
      color: #6b8f71;
      text-align: center;
      margin-bottom: 40px;
    }
    .card {
      background: #fff;
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 20px;
      box-shadow: 0 2px 12px rgba(45, 90, 61, 0.08);
      border: 1px solid #e8f0e8;
    }
    .card h2 {
      color: #3d6b4f;
      margin-bottom: 16px;
      font-size: 1.1em;
      font-weight: 600;
      border-bottom: 2px solid #c8e6c9;
      padding-bottom: 8px;
    }
    .row {
      display: flex;
      gap: 12px;
      align-items: center;
      margin-bottom: 12px;
      flex-wrap: wrap;
    }
    input, textarea {
      flex: 1;
      min-width: 200px;
      padding: 12px;
      border: 1px solid #d4e5d4;
      border-radius: 10px;
      font-size: 14px;
      transition: all 0.3s;
      background: #fafcfa;
    }
    input:focus, textarea:focus {
      outline: none;
      border-color: #81c784;
      background: #fff;
      box-shadow: 0 0 0 3px rgba(129, 199, 132, 0.15);
    }
    textarea {
      resize: vertical;
      min-height: 80px;
    }
    button {
      padding: 12px 24px;
      border: none;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      white-space: nowrap;
    }
    .btn-primary {
      background: #66bb6a;
      color: #fff;
    }
    .btn-primary:hover {
      background: #57a05a;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(102, 187, 106, 0.3);
    }
    .btn-success {
      background: #26a69a;
      color: #fff;
    }
    .btn-success:hover {
      background: #1e8e83;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(38, 166, 154, 0.3);
    }
    .btn-warning {
      background: #ffb74d;
      color: #5d4e37;
    }
    .btn-warning:hover {
      background: #ffa726;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(255, 183, 77, 0.3);
    }
    .btn-info {
      background: #4db6ac;
      color: #fff;
    }
    .btn-info:hover {
      background: #3d9e94;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(77, 182, 172, 0.3);
    }
    .result {
      background: #f5f9f5;
      border-radius: 10px;
      padding: 12px 16px;
      margin-top: 12px;
      font-size: 14px;
      color: #5a7d5f;
      min-height: 44px;
      display: flex;
      align-items: center;
      border: 1px solid #e0ebe0;
    }
    .result.success {
      background: #e8f5e9;
      color: #2e7d32;
      border-color: #c8e6c9;
    }
    .result.error {
      background: #ffebee;
      color: #c62828;
      border-color: #ffcdd2;
    }
    .paste-area {
      border: 2px dashed #a5d6a7;
      border-radius: 12px;
      padding: 24px;
      text-align: center;
      color: #66bb6a;
      background: #f1f8f1;
      transition: all 0.3s;
    }
    .paste-area:focus {
      outline: none;
      border-color: #66bb6a;
      background: #e8f5e9;
    }
    .paste-result {
      margin-top: 12px;
      text-align: left;
    }
    .permission-status {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 500;
      margin-left: 8px;
    }
    .permission-granted {
      background: #e8f5e9;
      color: #2e7d32;
    }
    .permission-denied {
      background: #ffebee;
      color: #c62828;
    }
    .permission-prompt {
      background: #fff8e1;
      color: #f57f17;
    }
    .permission-unsupported {
      background: #eceff1;
      color: #546e7a;
    }
    code {
      background: #e8f5e9;
      padding: 2px 8px;
      border-radius: 6px;
      font-family: "SF Mono", Monaco, "Consolas", monospace;
      font-size: 13px;
      color: #3d6b4f;
    }
    .note {
      font-size: 12px;
      color: #81a784;
      margin-top: 8px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>NowClipboard</h1>
    <p class="subtitle">现代剪贴板工具库 - 零依赖，支持浏览器和 Node.js</p>

    <!-- 1. HTML 属性绑定 -->
    <div class="card">
      <h2>1. HTML 属性绑定 (data-nc-*)</h2>
      <div class="row">
        <input type="text" id="source1" value="这是输入框的内容">
        <button class="btn-primary copy-btn" data-nc-target="#source1">复制输入框</button>
      </div>
      <div class="row">
        <button class="btn-primary copy-btn" data-nc-text="Hello NowClipboard!">复制固定文本</button>
        <code>data-nc-text="Hello NowClipboard!"</code>
      </div>
      <div id="result1" class="result">点击按钮测试复制功能</div>
    </div>

    <!-- 2. 剪切功能 -->
    <div class="card">
      <h2>2. 剪切功能 (Cut)</h2>
      <div class="row">
        <textarea id="cutSource">这段文字会被剪切（内容会清空）</textarea>
        <button class="btn-warning copy-btn" data-nc-target="#cutSource" data-nc-action="cut">剪切</button>
      </div>
      <div id="result2" class="result">点击剪切按钮，文本会被复制并清空</div>
    </div>

    <!-- 3. 静态方法 -->
    <div class="card">
      <h2>3. 静态方法 NowClipboard.copy()</h2>
      <div class="row">
        <input type="text" id="staticInput" placeholder="输入要复制的内容">
        <button class="btn-success" id="staticCopyBtn">复制</button>
      </div>
      <div id="result3" class="result">使用静态方法直接复制文本</div>
    </div>

    <!-- 4. 读取剪贴板 -->
    <div class="card">
      <h2>4. 读取剪贴板 NowClipboard.read()</h2>
      <div class="row">
        <button class="btn-info" id="readBtn">读取剪贴板内容</button>
      </div>
      <div id="result4" class="result">点击按钮读取剪贴板（需要 HTTPS 和用户授权）</div>
      <p class="note">注意：本地文件 (file://) 可能无法读取剪贴板，建议使用 HTTP 服务器</p>
    </div>

    <!-- 5. 粘贴监听 -->
    <div class="card">
      <h2>5. 粘贴监听 NowClipboard.onPaste()</h2>
      <div class="paste-area" id="pasteArea" tabindex="0">
        点击此处，然后按 Ctrl+V 粘贴
      </div>
      <div id="result5" class="result paste-result">粘贴内容将显示在这里</div>
    </div>

    <!-- 6. 权限检测 -->
    <div class="card">
      <h2>6. 权限检测 NowClipboard.queryPermission()</h2>
      <div class="row">
        <button class="btn-info" id="checkReadPermission">检测读取权限</button>
        <span id="readPermissionStatus"></span>
      </div>
      <div class="row">
        <button class="btn-info" id="checkWritePermission">检测写入权限</button>
        <span id="writePermissionStatus"></span>
      </div>
      <div id="result6" class="result">点击按钮检测剪贴板权限状态</div>
    </div>

    <!-- 7. 动态文本 -->
    <div class="card">
      <h2>7. 动态文本 (使用 text 函数)</h2>
      <div class="row">
        <button class="btn-success" id="dynamicBtn">复制当前时间</button>
      </div>
      <div id="result7" class="result">每次点击复制的内容都不同</div>
    </div>

    <!-- 8. 图片复制 -->
    <div class="card">
      <h2>8. 图片复制 NowClipboard.copyImage()</h2>
      <div class="row">
        <canvas id="demoCanvas" width="240" height="100" style="border:1px solid #d4e5d4; border-radius:10px; background:#fff;"></canvas>
        <button class="btn-primary" id="copyCanvasBtn">复制 Canvas 图片</button>
      </div>
      <div id="result8" class="result">复制图片到剪贴板（需要 HTTPS + 现代浏览器）</div>
      <p class="note">注意：图片复制需要浏览器支持 ClipboardItem API，且通常需要 HTTPS 环境</p>
    </div>

    <!-- 9. 富文本复制 -->
    <div class="card">
      <h2>9. 富文本复制 NowClipboard.copyRich()</h2>
      <div id="richContent" style="background:#fafcfa; border:1px solid #d4e5d4; border-radius:10px; padding:16px; margin-bottom:12px;">
        <h3 style="color:#2d5a3d; margin-bottom:8px;">NowClipboard 示例标题</h3>
        <p>这是一段包含 <strong>加粗</strong>、<em>斜体</em>、<span style="color:#e53935;">红色文字</span> 的富文本内容。</p>
        <ul style="margin-top:8px; padding-left:20px;">
          <li>支持 HTML 格式复制</li>
          <li>粘贴到 Word / 邮件中保留样式</li>
        </ul>
      </div>
      <div class="row">
        <button class="btn-primary" id="copyRichStaticBtn">静态方法复制</button>
        <button class="btn-success copy-btn" data-nc-target="#richContent" data-nc-html="true">属性绑定复制 (data-nc-html)</button>
      </div>
      <div id="result9" class="result">复制富文本，粘贴到 Word / 富文本编辑器中可保留格式</div>
    </div>
  </div>

  <script src="NowClipboard.js"></script>
  <script>
    // 1. HTML 属性绑定
    var clipboard = new NowClipboard('.copy-btn');
    var result1 = document.getElementById('result1');
    var result2 = document.getElementById('result2');

    clipboard.on('success', function (e) {
      var resultEl;
      if (e.action === 'cut') {
        resultEl = result2;
      } else if (e.trigger && e.trigger.getAttribute('data-nc-html') === 'true') {
        resultEl = document.getElementById('result9');
      } else {
        resultEl = result1;
      }
      resultEl.textContent = (e.action === 'copy' ? '复制' : '剪切') + '成功: ' + e.text;
      resultEl.className = 'result success';
      e.clearSelection();
    });

    clipboard.on('error', function (e) {
      var resultEl;
      if (e.action === 'cut') {
        resultEl = result2;
      } else if (e.trigger && e.trigger.getAttribute('data-nc-html') === 'true') {
        resultEl = document.getElementById('result9');
      } else {
        resultEl = result1;
      }
      resultEl.textContent = '操作失败: ' + e.error.message;
      resultEl.className = 'result error';
    });

    // 3. 静态方法
    var staticCopyBtn = document.getElementById('staticCopyBtn');
    var staticInput = document.getElementById('staticInput');
    var result3 = document.getElementById('result3');

    staticCopyBtn.addEventListener('click', function () {
      var text = staticInput.value || '默认文本';
      NowClipboard.copy(text).then(function (copied) {
        result3.textContent = '复制成功: ' + copied;
        result3.className = 'result success';
      }).catch(function (err) {
        result3.textContent = '复制失败: ' + err.message;
        result3.className = 'result error';
      });
    });

    // 4. 读取剪贴板
    var readBtn = document.getElementById('readBtn');
    var result4 = document.getElementById('result4');

    readBtn.addEventListener('click', function () {
      NowClipboard.read().then(function (text) {
        result4.textContent = '剪贴板内容: ' + (text || '(空)');
        result4.className = 'result success';
      }).catch(function (err) {
        result4.textContent = '读取失败: ' + err.message;
        result4.className = 'result error';
      });
    });

    // 5. 粘贴监听
    var result5 = document.getElementById('result5');

    NowClipboard.onPaste('#pasteArea', function (data) {
      var parts = [];
      if (data.text) parts.push('文本: ' + data.text);
      if (data.html) parts.push('HTML: ' + data.html.substring(0, 100) + (data.html.length > 100 ? '...' : ''));
      if (data.files && data.files.length) parts.push('文件: ' + data.files.length + ' 个');
      result5.textContent = parts.join(' | ') || '(无内容)';
      result5.className = 'result success';
    });

    // 6. 权限检测
    var result6 = document.getElementById('result6');

    function getPermissionClass(state) {
      if (state === 'granted') return 'permission-status permission-granted';
      if (state === 'denied') return 'permission-status permission-denied';
      if (state === 'prompt') return 'permission-status permission-prompt';
      return 'permission-status permission-unsupported';
    }

    document.getElementById('checkReadPermission').addEventListener('click', function () {
      NowClipboard.queryPermission('read').then(function (res) {
        var span = document.getElementById('readPermissionStatus');
        span.textContent = res.state;
        span.className = getPermissionClass(res.state);
        result6.textContent = '读取权限: ' + res.state;
        result6.className = 'result';
      }).catch(function (err) {
        result6.textContent = '查询失败: ' + err.message;
        result6.className = 'result error';
      });
    });

    document.getElementById('checkWritePermission').addEventListener('click', function () {
      NowClipboard.queryPermission('write').then(function (res) {
        var span = document.getElementById('writePermissionStatus');
        span.textContent = res.state;
        span.className = getPermissionClass(res.state);
        result6.textContent = '写入权限: ' + res.state;
        result6.className = 'result';
      }).catch(function (err) {
        result6.textContent = '查询失败: ' + err.message;
        result6.className = 'result error';
      });
    });

    // 7. 动态文本
    var dynamicBtn = document.getElementById('dynamicBtn');
    var result7 = document.getElementById('result7');

    dynamicBtn.addEventListener('click', function () {
      var now = new Date().toLocaleString('zh-CN');
      NowClipboard.copy('当前时间: ' + now).then(function (text) {
        result7.textContent = '复制成功: ' + text;
        result7.className = 'result success';
      }).catch(function (err) {
        result7.textContent = '复制失败: ' + err.message;
        result7.className = 'result error';
      });
    });

    // 8. 图片复制
    var demoCanvas = document.getElementById('demoCanvas');
    var ctx = demoCanvas.getContext('2d');

    // 绘制示例图形
    ctx.fillStyle = '#e8f5e9';
    ctx.fillRect(0, 0, 240, 100);
    ctx.fillStyle = '#66bb6a';
    ctx.beginPath();
    ctx.arc(50, 50, 30, 0, Math.PI * 2);
    ctx.fill();
    ctx.fillStyle = '#26a69a';
    ctx.fillRect(100, 20, 60, 60);
    ctx.fillStyle = '#2d5a3d';
    ctx.font = '14px sans-serif';
    ctx.fillText('Canvas', 175, 55);

    var result8 = document.getElementById('result8');

    document.getElementById('copyCanvasBtn').addEventListener('click', function () {
      NowClipboard.copyImage(demoCanvas).then(function (blob) {
        result8.textContent = '图片复制成功! 大小: ' + (blob.size / 1024).toFixed(1) + ' KB，可粘贴到聊天窗口或画图工具';
        result8.className = 'result success';
      }).catch(function (err) {
        result8.textContent = '图片复制失败: ' + err.message;
        result8.className = 'result error';
      });
    });

    // 9. 富文本复制（静态方法）
    var result9 = document.getElementById('result9');
    var richContentEl = document.getElementById('richContent');

    document.getElementById('copyRichStaticBtn').addEventListener('click', function () {
      var html = richContentEl.innerHTML;
      var text = richContentEl.textContent || richContentEl.innerText || '';
      NowClipboard.copyRich({ text: text, html: html }).then(function (res) {
        result9.textContent = '富文本复制成功! 纯文本长度: ' + res.text.length + '，HTML 长度: ' + res.html.length;
        result9.className = 'result success';
      }).catch(function (err) {
        result9.textContent = '富文本复制失败: ' + err.message;
        result9.className = 'result error';
      });
    });
  </script>
</body>
</html>
